---
title: Expander抽屉与背景模糊效果
layout: post
categories: WPF
tags: Blur
---
- __抽屉效果__
    - 有两点难点：一是打开Expander需要覆盖其他控件而不是将其他元素挤到一边，第二是打开的动画效果
    - 设置抽屉打开后的覆盖效果
        - 将Window的默认Grid布局替换为StackPanel，因为想要设置一个从左到右的Expander，所以将StackPanel的Orientation设置为Horizontal，并放入一个Canvas布局和一个Grid布局
        - 在Canvas布局中放入Expander（在对象和时间线中将Expander拖至其下方即可），将一些控件拖至Expander默认的Grid下方成为其子元素。Ps：Expander放入Canvas中不能占满高度，需要将Height绑定至Window的ActualHeight属性，对于无法自动调整的属性一般都需要用绑定方式进行调整。
        - 设置Canvas布局和Grid布局的ZIndex属性。覆盖顺序为较大的值在上方。
    - 设置打开和关闭动画效果
        - 选中Expander的Grid，新建触发器，在Expander Expanded时触发
        - 点击旁边的加号，新建一个故事版，此时是默认打开录制的，如果重新编辑故事版记得点击左上角的录制按钮
        - 之后就是拖动时间线（黄色的线）改变转换属性（一般不要用鼠标修改而是在Property面板上改动数值），改变属性会默认添加一个关键帧。
        - 选中多个关键帧，在属性中EasingFunction中选择曲线即可（比较喜欢Power曲线，可以修改其强度）

- __背景模糊效果__
    - 没有想出来Dragmove实时模糊的效果，虽然[有一篇Blog](http://blog.csdn.net/doffs/article/details/39827083)写到这种效果，但我猜想因为背景是ScrollViewer才行的通（大概）
    - 替换方案是ImageBrush有ViewBox属性，可以展现图片的一部分，利用此特性设置模糊效果
    - 首先新建一个Border，将其边框消除
    - 将BlurEffects拖入Border成为其子元素
    - 编写XMAL，将ImageBrush设置其Background，设定Source为被模糊背景相同的源，ViewBox属性设置为0, 0, Expander.ActualWidth/window.ActualWidth, 0（需要数据绑定）。这里为了方便我直接设置值。
    ```
      <Border BorderBrush="Black">
        <Border.Effect>
            <BlurEffect Radius="18"/>
        </Border.Effect>
        <Border.Background>
             <ImageBrush ImageSource="Source/Image/63069630_p0_master1200.jpg" 
                         Viewbox="0,0,0.55,1" Stretch="Fill" Opacity="0.5"/>
        </Border.Background>
      </Border>
    ```