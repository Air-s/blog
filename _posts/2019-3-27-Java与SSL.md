---
layout: post
title: Java与SSL
tags: [基础]
excerpt_separator: <!--more-->
---

写完发现内容似乎和 Java 联系并不大 __(:з」∠)_

<!--more-->

### 基础概念

![SSL](http://imglf3.nosdn0.126.net/img/NUt6Tlg5Wm81QnhsTU41dUZUN0hOMFQyb0M0ZTlBK2EyN0FSZjNkL0JkU1c0WUdXdnhiNk9BPT0.png?imageView&thumbnail=1680x0&quality=100&stripmeta=0)

> 引用自：[【亚洲诚信】SSL证书工作原理](https://www.trustasia.com/ssl-work-principle)

这张图还是很通俗易懂，简单的说利用以上步骤传输对称加密的秘钥进行加密传输，但仍然有几个问题

- 我听说过数字签名、证书、CA等一些概念，这些概念和上面的流程图有什么联系
- 我使用过 KeyTool 生成过证书，但是 keystore 是什么，那些生成的 .crt, .pem 还有其他一些奇怪的后缀名文件又是什么
- 我经常看到 “CA 根目录证书不被信任” 这个字样，所以根目录证书是什么，它和我申请的（自签的）证书有什么联系
- 抓包工具是如何抓取并解析 HTTPS 数据包的
- 我需要在 Nginx/Tomcat 等服务器实现安全传输，我该如何安装证书（在线等，急）

第一个问题：可以参考[《数字签名是什么？》](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html) 一文。参考上图关键在于公钥的校验，因为网络环境可以理解为一个黑箱，对方传给你的证书（其中包含公钥）你并不知晓其发送者是谁，因此需要通过手段验证此证书的合法性。

第二个问题：可以参考[《那些证书相关的玩意儿(SSL,X.509,PEM,DER,CRT,CER,KEY,CSR,P12等)》](https://www.cnblogs.com/guogangj/p/4118605.html)一文。不过自签证书部署相对麻烦（要给所有访问服务器的客户端添加此证书的信任），如果不是局域网内等特殊环境与要求需要这样做，只是想给你的网站升级，可以通过 [FreeSSL.org](https://freessl.cn/) 这个站点申请免费证书，再通过脚本自动续签证书即可。

第三个问题：好问题见下文（因为部分介绍 HTTPS 的文章没有涉及到这个点）

第四个问题：可以参考[《图解 HTTPS：Charles 捕获 HTTPS 的原理》](https://github.com/youngwind/blog/issues/108)和[《浅谈Charles抓取HTTPS原理》](https://www.jianshu.com/p/405f9d76f8c4)。简单的说就是浏览器请求后接收服务器的证书实际上是抓包工具动态生成的证书，因为之前你设置过信任工具生成的证书，因此这一步就没有问题。

第五个问题：可以参考[《【亚洲诚信】HTTPS证书如何安装》](https://www.trustasia.com/how-to-install-https-certificate) 一文

### 证书信任链校验

![](http://imglf6.nosdn0.126.net/img/NUt6Tlg5Wm81Qnk5dGlWYktnUGF3UWpJUC8vd2x4di8xS08wTHFIQzVxem4wdkxCcG9Gc2FnPT0.png?imageView&thumbnail=1680x0&quality=96&stripmeta=0)

> 引用自：[《OpenSSL-证书链》](https://blog.csdn.net/u011130578/article/details/76246863)一文





### Netty 建立 SSL 连接

